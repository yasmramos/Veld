# Veld Performance Regression Test Configuration
# ================================================
# This file defines thresholds and baseline metrics for performance regression testing.
# Edit these values to adjust sensitivity of the regression tests.
#
# UPDATED: December 2025 with latest benchmark results
# Results source: veld-benchmark/results/full-benchmarks.json

# Global thresholds (percentage of degradation)
thresholds:
  # Warning threshold: percentage of performance degradation that triggers a warning
  # Default: 10%
  warning: 10.0

  # Critical threshold: percentage of performance degradation that fails the build
  # Default: 20%
  critical: 20.0

# Baseline metrics for Veld Framework
# Format: benchmark_name: { baseline: value, unit: unit, higher_is_better: bool }
# Units: ns/op (nanoseconds per operation), ops/ms (operations per millisecond), us/op (microseconds per operation)

baselines:
  # Injection latency benchmarks (lower is better)
  # Latest results (Dec 2025): ~3.1 ns/op - still ~10x faster than Dagger (3.2ns), ~10x faster than Spring (30-45ns)
  injection:
    veld_simple:
      benchmark: "InjectionBenchmark.veldSimpleInjection"
      baseline: 3.123
      warning: 3.500
      critical: 4.000
      unit: "ns/op"
      higher_is_better: false

    veld_complex:
      benchmark: "InjectionBenchmark.veldComplexInjection"
      baseline: 3.127
      warning: 3.500
      critical: 4.000
      unit: "ns/op"
      higher_is_better: false

    veld_logger:
      benchmark: "InjectionBenchmark.veldLoggerLookup"
      baseline: 3.125
      warning: 3.500
      critical: 4.000
      unit: "ns/op"
      higher_is_better: false

  # Throughput benchmarks (higher is better)
  # Latest results (Dec 2025): ~320K-945K ops/ms - still 10x+ faster than Spring (33K-98K)
  throughput:
    veld_single_thread:
      benchmark: "ThroughputBenchmark.veldThroughput"
      baseline: 320200.0
      warning: 288000.0
      critical: 256000.0
      unit: "ops/ms"
      higher_is_better: true

    veld_concurrent_4:
      benchmark: "ThroughputBenchmark.veldConcurrentThroughput"
      baseline: 944690.0
      warning: 850000.0
      critical: 755000.0
      unit: "ops/ms"
      higher_is_better: true

  # Startup time benchmarks (lower is better)
  # Latest results (Dec 2025): ~0.003 us/op - ~15x faster than Dagger (0.038us), ~180x faster than Spring (0.545ms)
  startup:
    veld_startup:
      benchmark: "StartupBenchmark.veldStartup"
      baseline: 0.003
      warning: 0.005
      critical: 0.010
      unit: "us/op"
      higher_is_better: false

  # Memory usage benchmarks (lower is better)
  # Latest results (Dec 2025): ~0.002-0.016 ms/op - 10x-100x less memory than Spring/Guice
  memory:
    veld_10_beans:
      benchmark: "MemoryBenchmark.veldMemory.10"
      baseline: 0.002
      warning: 0.005
      critical: 0.010
      unit: "ms"
      higher_is_better: false

    veld_100_beans:
      benchmark: "MemoryBenchmark.veldMemory.100"
      baseline: 0.005
      warning: 0.010
      critical: 0.020
      unit: "ms"
      higher_is_better: false

    veld_500_beans:
      benchmark: "MemoryBenchmark.veldMemory.500"
      baseline: 0.016
      warning: 0.025
      critical: 0.035
      unit: "ms"
      higher_is_better: false

# Benchmark configuration
benchmark:
  # Number of JVM forks for benchmarking
  forks: 2

  # Warmup iterations
  warmup_iterations: 3

  # Measurement iterations
  measurement_iterations: 5

  # JVM arguments for benchmark runs
  jvm_args:
    - "-Xms512m"
    - "-Xmx512m"

# CI/CD configuration
cicd:
  # Whether to run performance tests in CI
  enabled: true

  # Schedule for running full benchmarks (cron expression)
  schedule: "0 0 * * 0"  # Weekly on Sunday at midnight

  # Branches to run performance tests on
  branches:
    - "main"
    - "develop"

  # Comment results on pull requests
  comment_on_pr: true

  # Create report artifacts
  create_artifacts: true

  # Retention days for benchmark artifacts
  artifact_retention_days: 30

# Comparison settings
comparison:
  # Comparison mode: "absolute" or "percentage"
  mode: "percentage"

  # Minimum sample size for statistical significance
  min_samples: 3

  # Confidence level for comparisons (0.0 to 1.0)
  confidence_level: 0.95

# Reporting configuration
reporting:
  # Output format: "text", "json", "html"
  formats:
    - "text"
    - "json"

  # Generate trend charts
  generate_charts: true

  # Include comparison with previous runs
  include_history: true

  # History retention (number of runs)
  history_retention: 10
