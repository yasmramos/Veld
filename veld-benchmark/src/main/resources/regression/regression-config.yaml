# Veld Performance Regression Test Configuration
# ================================================
# This file defines thresholds and baseline metrics for performance regression testing.
# Edit these values to adjust sensitivity of the regression tests.

# Global thresholds (percentage of degradation)
thresholds:
  # Warning threshold: percentage of performance degradation that triggers a warning
  # Default: 10%
  warning: 10.0

  # Critical threshold: percentage of performance degradation that fails the build
  # Default: 20%
  critical: 20.0

# Baseline metrics for Veld Framework
# Format: benchmark_name: { baseline: value, unit: unit, higher_is_better: bool }
# Units: ns/op (nanoseconds per operation), ops/ms (operations per millisecond), us/op (microseconds per operation)

baselines:
  # Injection latency benchmarks (lower is better)
  # These values are from JMH benchmark runs on typical hardware
  injection:
    veld_simple:
      benchmark: "InjectionBenchmark.veldSimpleInjection"
      baseline: 0.320
      warning: 0.350
      critical: 0.400
      unit: "ns/op"
      higher_is_better: false

    veld_complex:
      benchmark: "InjectionBenchmark.veldComplexInjection"
      baseline: 0.325
      warning: 0.360
      critical: 0.420
      unit: "ns/op"
      higher_is_better: false

    veld_logger:
      benchmark: "InjectionBenchmark.veldLoggerLookup"
      baseline: 0.320
      warning: 0.350
      critical: 0.400
      unit: "ns/op"
      higher_is_better: false

  # Throughput benchmarks (higher is better)
  throughput:
    veld_single_thread:
      benchmark: "ThroughputBenchmark.veldSingleThread"
      baseline: 3118161.0
      warning: 2800000.0
      critical: 2500000.0
      unit: "ops/ms"
      higher_is_better: true

    veld_concurrent_4:
      benchmark: "ThroughputBenchmark.veldConcurrent4"
      baseline: 5915896.0
      warning: 5300000.0
      critical: 4700000.0
      unit: "ops/ms"
      higher_is_better: true

  # Startup time benchmarks (lower is better)
  startup:
    veld_startup:
      benchmark: "StartupBenchmark.veldStartup"
      baseline: 0.001
      warning: 0.005
      critical: 0.010
      unit: "us/op"
      higher_is_better: false

  # Memory usage benchmarks (lower is better)
  memory:
    veld_10_beans:
      benchmark: "MemoryBenchmark.veld10Beans"
      baseline: 0.005
      warning: 0.010
      critical: 0.020
      unit: "ms"
      higher_is_better: false

    veld_100_beans:
      baseline: 0.036
      warning: 0.050
      critical: 0.070
      unit: "ms"
      higher_is_better: false

    veld_500_beans:
      baseline: 0.024
      warning: 0.035
      critical: 0.050
      unit: "ms"
      higher_is_better: false

# Benchmark configuration
benchmark:
  # Number of JVM forks for benchmarking
  forks: 2

  # Warmup iterations
  warmup_iterations: 3

  # Measurement iterations
  measurement_iterations: 5

  # JVM arguments for benchmark runs
  jvm_args:
    - "-Xms512m"
    - "-Xmx512m"

# CI/CD configuration
cicd:
  # Whether to run performance tests in CI
  enabled: true

  # Schedule for running full benchmarks (cron expression)
  schedule: "0 0 * * 0"  # Weekly on Sunday at midnight

  # Branches to run performance tests on
  branches:
    - "main"
    - "develop"

  # Comment results on pull requests
  comment_on_pr: true

  # Create report artifacts
  create_artifacts: true

  # Retention days for benchmark artifacts
  artifact_retention_days: 30

# Comparison settings
comparison:
  # Comparison mode: "absolute" or "percentage"
  mode: "percentage"

  # Minimum sample size for statistical significance
  min_samples: 3

  # Confidence level for comparisons (0.0 to 1.0)
  confidence_level: 0.95

# Reporting configuration
reporting:
  # Output format: "text", "json", "html"
  formats:
    - "text"
    - "json"

  # Generate trend charts
  generate_charts: true

  # Include comparison with previous runs
  include_history: true

  # History retention (number of runs)
  history_retention: 10
