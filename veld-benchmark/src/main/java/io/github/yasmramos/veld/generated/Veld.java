package io.github.yasmramos.veld.generated;

import java.util.ArrayList;
import java.util.List;

import io.github.yasmramos.veld.benchmark.veld.*;

/**
 * Ultra-fast DI container - manually written example of generated code.
 * All singletons initialized in static block (thread-safe, zero runtime overhead).
 * 
 * This demonstrates the structure that Veld processor generates at compile-time.
 * For benchmarks, we use this manual version to avoid circular dependency with the processor.
 * 
 * NOTE: VeldSourceGenerator was removed as it was duplicating functionality.
 * Real projects use the processor-generated bytecode via ComponentFactory and Registry.
 */
public final class Veld {

    // === SINGLETON FIELDS (static final = JIT inlines) ===
    private static final VeldLogger _veldLogger;
    private static final VeldValidator _veldValidator;
    private static final VeldRepository _veldRepository;
    private static final VeldSimpleService _veldSimpleService;
    private static final VeldComplexService _veldComplexService;

    // === LOOKUP ARRAYS ===
    private static final Class<?>[] _types;
    private static final Object[] _instances;

    // === STATIC INITIALIZER (JVM guarantees thread-safety) ===
    static {
        _veldLogger = new VeldLogger();
        _veldValidator = new VeldValidator();
        _veldRepository = new VeldRepository();
        _veldSimpleService = new VeldSimpleService(_veldLogger);
        _veldComplexService = new VeldComplexService(_veldRepository, _veldLogger, _veldValidator);

        _types = new Class<?>[] {
            VeldLogger.class,
            io.github.yasmramos.veld.benchmark.common.Logger.class,
            VeldValidator.class,
            VeldRepository.class,
            VeldSimpleService.class,
            io.github.yasmramos.veld.benchmark.common.Service.class,
            VeldComplexService.class
        };
        _instances = new Object[] {
            _veldLogger,
            _veldLogger,
            _veldValidator,
            _veldRepository,
            _veldSimpleService,
            _veldSimpleService,
            _veldComplexService
        };
    }

    private Veld() {}

    // === DIRECT GETTERS (no AOP - ultra-fast) ===
    public static VeldLogger veldLogger() {
        return _veldLogger;
    }

    public static VeldValidator veldValidator() {
        return _veldValidator;
    }

    public static VeldRepository veldRepository() {
        return _veldRepository;
    }

    // === GETTER WITH AOP (interceptors inlined directly) ===
    public static VeldSimpleService veldSimpleService() {
        // AOP: Pre-invocation interceptors would be inlined here
        // e.g., logging, security checks, transaction begin
        VeldSimpleService instance = _veldSimpleService;
        // AOP: Post-invocation interceptors would be inlined here  
        // e.g., transaction commit, metrics
        return instance;
    }

    public static VeldComplexService veldComplexService() {
        return _veldComplexService;
    }

    // === CONTAINER API (O(1) lookup via if-else chain) ===

    @SuppressWarnings("unchecked")
    public static <T> T get(Class<T> type) {
        // Direct reference comparison - JIT inlines this completely
        if (type == VeldLogger.class || type == io.github.yasmramos.veld.benchmark.common.Logger.class) {
            return (T) _veldLogger;
        }
        if (type == VeldSimpleService.class || type == io.github.yasmramos.veld.benchmark.common.Service.class) {
            return (T) _veldSimpleService;
        }
        if (type == VeldComplexService.class) {
            return (T) _veldComplexService;
        }
        if (type == VeldValidator.class) {
            return (T) _veldValidator;
        }
        if (type == VeldRepository.class) {
            return (T) _veldRepository;
        }
        return null;
    }

    @SuppressWarnings("unchecked")
    public static <T> List<T> getAll(Class<T> type) {
        List<T> result = new ArrayList<>();
        for (int i = 0; i < _types.length; i++) {
            if (type.isAssignableFrom(_types[i])) {
                result.add((T) _instances[i]);
            }
        }
        return result;
    }

    public static boolean contains(Class<?> type) {
        return get(type) != null;
    }

    public static int componentCount() {
        return 5;
    }
}
